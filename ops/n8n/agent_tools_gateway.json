{"name":"Agent Tools Gateway (Dominion)","nodes":[{"parameters":{"httpMethod":"POST","path":"agent-tools","responseMode":"onReceived","options":{}},"name":"Webhook Agent Tools","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[100,200]},{"parameters":{"functionCode":"/* Auth & parse body. Return 401 in __statusCode if auth fails. */\nconst headers = $json.headers || {};\nconst key = headers['x-agent-key'] || headers['X-AGENT-KEY'] || '';\nif (!key || key !== $env.N8N_TOOL_SECRET) {\n  return [{ ok:false, error:'unauthorized', __statusCode:401 }];\n}\nconst body = $json;\nconst tool = body.tool;\nconst args = body.args || {};\nreturn [{ tool, args }];"},"name":"Auth & Parse","type":"n8n-nodes-base.function","typeVersion":1,"position":[360,200]},{"parameters":{"rules":[{"value1":"={{ $json.tool }}","operation":"equal","value2":"publish_content"},{"value1":"={{ $json.tool }}","operation":"equal","value2":"roi_snapshot"},{"value1":"={{ $json.tool }}","operation":"equal","value2":"email_followup"},{"value1":"={{ $json.tool }}","operation":"equal","value2":"trading_execute"}],"combineOperation":"or"},"name":"Tool Selector","type":"n8n-nodes-base.switch","typeVersion":1,"position":[620,200]},{"parameters":{"functionCode":"/* publish_content stub */\nconst { args } = $json;\nreturn [{ ok:true, result:{ status:'drafted_or_posted', echo: args } }];"},"name":"Publish Stub","type":"n8n-nodes-base.function","typeVersion":1,"position":[880,60]},{"parameters":{"functionCode":"/* roi_snapshot stub */\nconst { args } = $json;\nreturn [{ ok:true, result:{ revenue:0, orders:0, params: args } }];"},"name":"ROI Stub","type":"n8n-nodes-base.function","typeVersion":1,"position":[880,200]},{"parameters":{"functionCode":"/* email_followup stub - respects dry_run */\nconst { args } = $json;\nconst dry = args && args.dry_run === true;\nreturn [{ ok:true, result:{ sent: !dry, mode: dry ? 'dry_run' : 'live', params: args } }];"},"name":"Email Stub","type":"n8n-nodes-base.function","typeVersion":1,"position":[880,340]},{"parameters":{"requestMethod":"POST","url":"={{ $env.N8N_AGENT_GATEWAY_URL ? ($env.N8N_AGENT_GATEWAY_URL.split('/webhook')[0] + '/webhook/trading-hook') : 'http://localhost:5678/webhook/trading-hook' }}","options":{"headers":{"X-AGENT-KEY":"={{ $env.N8N_TOOL_SECRET }}","Content-Type":"application/json"}},"bodyParametersJson":"={{ JSON.stringify($json.args || {}) }}","returnFullResponse":true,"encoding":"utf8"},"name":"Trading Forward","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[880,460]},{"parameters":{"functionCode":"/* Normalize HTTP response to body JSON */\n// If we got a response from HTTP Request node the raw data is under $json[\"body\"] or $node['Trading Forward'].json\nconst body = $json || {};\nif (body && body.statusCode) {\n  // in case HTTP request returned full response\n  try {\n    const parsed = JSON.parse(body.body || '{}');\n    return [parsed];\n  } catch (e) {\n    return [{ ok:false, error:'invalid_json_from_trading_hook', raw: body.body }];\n  }\n}\nreturn [body];"},"name":"Normalize Trading Resp","type":"n8n-nodes-base.function","typeVersion":1,"position":[1140,460]},{"parameters":{"responseMode":"lastNode","responseData":"={{ $json }}","responseCode":"={{ $json.__statusCode ? $json.__statusCode : 200 }}","options":{}},"name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[1400,200]},{"parameters":{"functionCode":"/* Check approval: if args.require_approval === true, short-circuit to Respond with needs_approval. Otherwise forward input unchanged. */\nconst item = $json;\nconst args = item.args || {};\nif (args.require_approval === true) {\n  return [{ ok:false, needs_approval:true, plan: { tool: item.tool, args } }];\n}\nreturn [item];"},"name":"Approval Gate","type":"n8n-nodes-base.function","typeVersion":1,"position":[940,200]}],"connections":{"Webhook Agent Tools":{"main":[[{"node":"Auth & Parse","type":"main","index":0}]]},"Auth & Parse":{"main":[[[{"node":"Approval Gate","type":"main","index":0}]]]},"Approval Gate":{"main":[[[{"node":"Tool Selector","type":"main","index":0}]]]},"Tool Selector":{"main":[[[{"node":"Publish Stub","type":"main","index":0}]],[[{"node":"ROI Stub","type":"main","index":0}]],[[{"node":"Email Stub","type":"main","index":0}]],[[{"node":"Trading Forward","type":"main","index":0}]]]},"Publish Stub":{"main":[[[{"node":"Respond to Webhook","type":"main","index":0}]]]},"ROI Stub":{"main":[[[{"node":"Respond to Webhook","type":"main","index":0}]]]},"Email Stub":{"main":[[[{"node":"Respond to Webhook","type":"main","index":0}]]]},"Trading Forward":{"main":[[[{"node":"Normalize Trading Resp","type":"main","index":0}]]]},"Normalize Trading Resp":{"main":[[[{"node":"Respond to Webhook","type":"main","index":0}]]]}},